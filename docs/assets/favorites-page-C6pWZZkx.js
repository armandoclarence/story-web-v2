var L=i=>{throw TypeError(i)};var p=(i,t,e)=>t.has(i)||L("Cannot "+e);var s=(i,t,e)=>(p(i,t,"read from private field"),e?e.call(i):t.get(i)),m=(i,t,e)=>t.has(i)?L("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(i):t.set(i,e),u=(i,t,e,a)=>(p(i,t,"write to private field"),a?a.call(i,e):t.set(i,e),e),w=(i,t,e)=>(p(i,t,"access private method"),e);var F=(i,t,e,a)=>({set _(o){u(i,t,o,e)},get _(){return s(i,t,a)}});import{s as S}from"./api-mapper-BXV2r0rj.js";import{F as v,S as E,g as M}from"./index-Cc-LqiTG.js";import{g as B}from"./map-B_YqZYlB.js";class P{constructor({view:t,model:e}){this.view=t,this.model=e}async loadFavorites(t){try{const e=await v.getAllFavorites();if(!e||e.length===0){await this.view.showFavorites([]);return}const o=(await Promise.all(e.map(async f=>{try{const y=await this.model.getStoryById(f.id);return y.ok?y.story:null}catch(y){return console.error("Error fetching story:",y),null}}))).filter(f=>f!==null),r=(t.page-1)*t.size,c=r+t.size,l=o.slice(r,c);await this.view.showFavorites(o)}catch(e){console.error("Error loading favorites:",e),await this.view.showFavorites([])}}async toggleFavorite(t){try{if(await v.isFavorite(t))await v.removeFavorite(t);else{const a=await this.model.getStoryById(t);a.ok&&await v.addFavorite(a.story)}}catch(e){throw console.error("Error toggling favorite:",e),e}}}var n,g,d,h,I,T;class A{constructor(){m(this,h);m(this,n,1);m(this,g,10);m(this,d)}async render(){return`
      <section class="container">
        <h1 class="section-title">Cerita Favorit</h1>
        <div id="favorites-list" class="stories-list"></div>
        <div id="pagination-container"></div>
      </section>
    `}async afterRender(){u(this,d,new P({view:this,model:E})),await v.init(E),document.addEventListener("favorites-updated",async t=>{await this.showFavorites(t.detail)}),await s(this,d).loadFavorites({page:s(this,n),size:s(this,g)}),w(this,h,I).call(this),w(this,h,T).call(this)}async showFavorites(t){const e=document.getElementById("favorites-list"),a=document.getElementById("pagination-container");if(!t||t.length===0){e&&(e.innerHTML="<p>Belum ada cerita favorit.</p>"),a&&(a.innerHTML="");return}try{const o=await Promise.all(t.map(async r=>{const c=await S(r),l=await v.isFavorite(r.id);return M({...c,isFavorited:l})}));if(e&&(e.innerHTML=o.join(""),setTimeout(()=>{e.querySelectorAll(".story-item").forEach((c,l)=>{c.style.opacity="0",c.style.transform="translateY(20px)",setTimeout(()=>{c.style.opacity="1",c.style.transform="translateY(0)"},l*100)})},50)),a){const r=t.length<s(this,g);a.innerHTML=B(s(this,n),r)}}catch(o){console.error("Error showing favorites:",o),e&&(e.innerHTML="<p>Terjadi kesalahan saat memuat cerita favorit.</p>"),a&&(a.innerHTML="")}}}n=new WeakMap,g=new WeakMap,d=new WeakMap,h=new WeakSet,I=function(){const t=document.getElementById("pagination-container");t&&t.addEventListener("click",async e=>{e.target.closest("#prev-page")?s(this,n)>1&&(F(this,n)._--,await s(this,d).loadFavorites({page:s(this,n),size:s(this,g)})):e.target.closest("#next-page")&&(F(this,n)._++,await s(this,d).loadFavorites({page:s(this,n),size:s(this,g)}))})},T=function(){const t=document.getElementById("favorites-list");t&&t.addEventListener("click",async e=>{const a=e.target.closest(".story-item__favorite");if(!a)return;const o=a.dataset.storyId;if(o)try{if(a.classList.contains("active")){await s(this,d).toggleFavorite(o);const r=a.closest(".story-item");r&&(r.classList.add("removing"),await new Promise(l=>{r.addEventListener("transitionend",()=>{r.remove(),l()},{once:!0})})),t.querySelectorAll(".story-item").length===0&&setTimeout(()=>{t.innerHTML="<p>Belum ada cerita favorit.</p>";const l=document.getElementById("pagination-container");l&&(l.innerHTML="")},300)}}catch(r){console.error("Error toggling favorite:",r),alert("Gagal menghapus cerita dari favorit.")}})};export{A as default};
