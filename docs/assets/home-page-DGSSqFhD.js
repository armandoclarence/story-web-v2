var E=e=>{throw TypeError(e)};var y=(e,t,i)=>t.has(e)||E("Cannot "+i);var s=(e,t,i)=>(y(e,t,"read from private field"),i?i.call(e):t.get(e)),l=(e,t,i)=>t.has(e)?E("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(e):t.set(e,i),h=(e,t,i,o)=>(y(e,t,"write to private field"),o?o.call(e,i):t.set(e,i),i),v=(e,t,i)=>(y(e,t,"access private method"),i);var L=(e,t,i,o)=>({set _(d){h(e,t,d,i)},get _(){return s(e,t,o)}});import{F as p,S,g as M,a as H,b as P}from"./index-Cnc8aRKT.js";import{s as _}from"./api-mapper-DOL4rTrE.js";import{g as k,a as z}from"./map-CFCXIuGV.js";var r,f;class C{constructor({view:t,model:i}){l(this,r);l(this,f);h(this,r,t),h(this,f,i)}async loadStories({page:t,size:i}){try{s(this,r).showLoading();const o=await s(this,f).getStories({page:t,size:i});if(!o.ok)throw new Error(o.error||"Failed to load stories");await s(this,r).populateStoriesList("",o.listStory,o.isFromCache)}catch(o){s(this,r).populateStoriesListError(o.message)}finally{s(this,r).hideLoading()}}async toggleFavorite(t){try{if(await p.isFavorite(t))await p.removeFavorite(t);else{const o=await s(this,f).getStoryById(t);o.ok&&await p.addFavorite(o.story)}}catch(i){throw console.error("Error toggling favorite:",i),i}}}r=new WeakMap,f=new WeakMap;var n,c,a,m,I,F;class j{constructor(){l(this,m);l(this,n,1);l(this,c,10);l(this,a)}async render(){return`
      <section class="container">
        <h1 class="section-title">Daftar Story</h1>

        <div class="stories-list__container">
          <div id="offline-indicator"></div>
          <div id="stories-list"></div>
          <div id="stories-list-loading-container"></div>
          <div id="pagination-container"></div>
        </div>
      </section>
    `}async afterRender(){h(this,a,new C({view:this,model:S})),await p.init(S),await s(this,a).loadStories({page:s(this,n),size:s(this,c)}),v(this,m,F).call(this),v(this,m,I).call(this)}async populateStoriesList(t,i,o=!1){if((i==null?void 0:i.length)<=0){this.populateStoriesListEmpty();return}const d=await Promise.all(i.map(async g=>{const B=await _(g),T=await p.isFavorite(g.id);return M({...B,isFavorited:T,isOffline:o})})).then(g=>g.join("")),u=document.getElementById("stories-list");if(!u){console.error("Element 'stories-list' not found!");return}u.innerHTML=`
      <div class="stories-list">${d}</div>
    `;const w=document.getElementById("pagination-container");if(w){const g=i.length<s(this,c);w.innerHTML=k(s(this,n),g)}o?this.showOfflineIndicator():this.hideOfflineIndicator()}populateStoriesListEmpty(){const t=document.getElementById("stories-list");if(!t){console.error("Element 'stories-list' not found!");return}t.innerHTML=H()}populateStoriesListError(t){const i=document.getElementById("stories-list");if(!i){console.error("Element 'stories-list' not found!");return}i.innerHTML=P(t)}showLoading(){const t=document.getElementById("stories-list-loading-container");if(!t){console.error("Element 'stories-list-loading-container' not found!");return}t.innerHTML=z()}hideLoading(){const t=document.getElementById("stories-list-loading-container");if(!t){console.error("Element 'stories-list-loading-container' not found!");return}t.innerHTML=""}showOfflineIndicator(){const t=document.getElementById("offline-indicator");if(!t)return;t.innerHTML=`
      <div class="offline-indicator">
        <i class="fas fa-wifi wifi-slash"></i>
        <span>Anda sedang offline. Menampilkan cerita yang tersimpan.</span>
        <button class="offline-indicator__retry">Coba Lagi</button>
      </div>
    `;const i=t.querySelector(".offline-indicator__retry");i&&i.addEventListener("click",()=>{window.location.reload()})}hideOfflineIndicator(){const t=document.getElementById("offline-indicator");t&&(t.innerHTML="")}}n=new WeakMap,c=new WeakMap,a=new WeakMap,m=new WeakSet,I=function(){const t=document.getElementById("stories-list");t&&t.addEventListener("click",async i=>{const o=i.target.closest(".story-item__favorite");if(!o)return;const d=o.dataset.storyId;if(d)try{o.classList.contains("active")&&await s(this,a).toggleFavorite(d)}catch(u){console.error("Error toggling favorite:",u),alert("Gagal menghapus cerita dari favorit.")}})},F=function(){const t=document.getElementById("pagination-container");t&&t.addEventListener("click",async i=>{i.target.closest("#prev-page")?s(this,n)>1&&(L(this,n)._--,await s(this,a).loadStories({page:s(this,n),size:s(this,c)})):i.target.closest("#next-page")&&(L(this,n)._++,await s(this,a).loadStories({page:s(this,n),size:s(this,c)}))})};export{j as default};
