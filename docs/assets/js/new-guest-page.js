var E=o=>{throw TypeError(o)};var y=(o,t,e)=>t.has(o)||E("Cannot "+e);var n=(o,t,e)=>(y(o,t,"read from private field"),e?e.call(o):t.get(o)),u=(o,t,e)=>t.has(o)?E("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(o):t.set(o,e),h=(o,t,e,a)=>(y(o,t,"write to private field"),a?a.call(o,e):t.set(o,e),e),r=(o,t,e)=>(y(o,t,"access private method"),e);import k from"./new-guest-presenter.js";import{S as T,C as M,e as S,d as P}from"./index.js";import{g as C,a as x}from"./form-templates.js";import{M as f}from"./map.js";var g,s,d,b,l,m,i,w,I,B,L,p,v;class O{constructor(){u(this,i);u(this,g);u(this,s);u(this,d);u(this,b,!1);u(this,l,[]);u(this,m,null)}async render(){return C(!0,await f.isPermissionsGeolocationGranted())}async afterRender(){h(this,g,new k({view:this,model:T})),h(this,l,[]),n(this,g).showNewFormMap(),r(this,i,w).call(this)}async initialMap(){if(!document.querySelector("#map")||(h(this,m,await f.build("#map",{zoom:15})),!n(this,m)))return;const t=n(this,m).getCenter();n(this,m).changeCamera([t.latitude,t.longitude]),r(this,i,I).call(this,t.latitude,t.longitude);const e=n(this,m).addMarker([t.latitude,t.longitude],{draggable:"true"});e.addEventListener("move",a=>{const c=a.target.getLatLng();r(this,i,I).call(this,c.lat,c.lng)}),n(this,m).addMapEventListener("click",a=>{e.setLatLng(a.latlng),a.sourceTarget.flyTo(a.latlng)})}storeSuccessfully(t){alert(t),console.log(t),this.clearForm(),location.hash="/"}storeFailed(t){alert(t),console.log(t)}clearForm(){n(this,s).reset()}showMapLoading(){document.getElementById("map-loading-container")&&(document.getElementById("map-loading-container").innerHTML=P())}hideMapLoading(){document.getElementById("map-loading-container")&&(document.getElementById("map-loading-container").innerHTML="")}showSubmitLoadingButton(){document.getElementById("submit-button-container")&&(document.getElementById("submit-button-container").innerHTML=`
        <button class="btn" type="submit" disabled>
          <i class="fas fa-spinner loader-button"></i> Buat Cerita
        </button>
      `)}hideSubmitLoadingButton(){document.getElementById("submit-button-container")&&(document.getElementById("submit-button-container").innerHTML=`
        <button class="btn" type="submit">Buat Cerita</button>
      `)}}g=new WeakMap,s=new WeakMap,d=new WeakMap,b=new WeakMap,l=new WeakMap,m=new WeakMap,i=new WeakSet,w=function(){h(this,s,document.getElementById("new-form")),n(this,s).addEventListener("submit",async e=>{if(e.preventDefault(),n(this,s).elements.namedItem("description").value===""){alert("Keterangan tidak boleh kosong");return}if(n(this,l).length===0){alert("Dokumentasi tidak boleh kosong");return}let a={description:n(this,s).elements.namedItem("description").value,photo:n(this,l)[0].blob};await f.isPermissionsGeolocationGranted()&&(a={...a,lat:n(this,s).elements.namedItem("latitude").value,lon:n(this,s).elements.namedItem("longitude").value}),await n(this,g).postNewStoryGuest(a)}),document.getElementById("photo-input").addEventListener("change",async e=>{const a=Object.values(e.target.files).map(async c=>await r(this,i,L).call(this,c));await Promise.all(a),await r(this,i,p).call(this)}),document.getElementById("photo-input-button").addEventListener("click",()=>{n(this,s).elements.namedItem("photo-input").click()});const t=document.getElementById("camera-container");document.getElementById("open-photo-camera-button").addEventListener("click",async e=>{r(this,i,B).call(this),h(this,b,t.classList.contains("open")),n(this,b)?(t.classList.remove("open"),e.currentTarget.textContent="Buka Kamera",n(this,d).stop()):(t.classList.add("open"),e.currentTarget.textContent="Tutup Kamera",await n(this,d).launch())})},I=function(t,e){n(this,s).elements.namedItem("latitude").value=t,n(this,s).elements.namedItem("longitude").value=e},B=function(){n(this,d)||h(this,d,new M({video:document.getElementById("camera-video"),cameraSelect:document.getElementById("camera-select"),canvas:document.getElementById("camera-canvas")})),n(this,d).addCheeseButtonListener("#camera-take-button",async()=>{const t=await n(this,d).takePicture();await r(this,i,L).call(this,t),await r(this,i,p).call(this)})},L=async function(t){let e=t;t instanceof String&&(e=S(t,"image/png"));const a={id:`${Date.now()}-${Math.random().toString(36).substring(2,9)}`,blob:e};h(this,l,[...n(this,l),a])},p=async function(){const t=n(this,l).reduce((e,a)=>{const c=URL.createObjectURL(a.blob);return e+x(c,a.id)},"");document.getElementById("photo-taken-list").innerHTML=t,document.querySelectorAll("button[data-index]").forEach(e=>e.addEventListener("click",async a=>{const c=a.currentTarget.dataset.index;r(this,i,v).call(this,c),await r(this,i,p).call(this)}))},v=function(t){const e=n(this,l).findIndex(a=>(a.id||"").toString()===t.toString());if(e!==-1){const a=document.querySelector(`[data-photo-id="${t}"]`);a&&(a.style.transition="all 0.3s ease",a.style.opacity="0",a.style.transform="scale(0.  8)",setTimeout(()=>{n(this,l).splice(e,1),document.getElementById("photo-input").value="",r(this,i,p).call(this)},300))}};export{O as default};
