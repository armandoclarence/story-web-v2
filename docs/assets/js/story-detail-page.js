var u=a=>{throw TypeError(a)};var g=(a,t,o)=>t.has(a)||u("Cannot "+o);var e=(a,t,o)=>(g(a,t,"read from private field"),o?o.call(a):t.get(a)),y=(a,t,o)=>t.has(a)?u("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(a):t.set(a,o),m=(a,t,o,n)=>(g(a,t,"write to private field"),n?n.call(a,o):t.set(a,o),o);import{I as M,p as B,S as E,d as I,e as L,f as T,h as p}from"./index.js";import{a as v,b}from"./ui-templates.js";import{s as S}from"./api-mapper.js";import{M as D}from"./map.js";var d,i,l;class k{constructor(t,{view:o,apiModel:n}){y(this,d);y(this,i);y(this,l);m(this,d,t),m(this,i,o),m(this,l,n)}async showStoryDetailMap(){e(this,i).showMapLoading();try{await e(this,i).initialMap()}catch(t){console.error("showStoryDetailMap: error:",t)}finally{e(this,i).hideMapLoading()}}async showStoryDetail(){e(this,i).showStoryDetailLoading();try{const t=await e(this,l).getStoryById(e(this,d));if(!t.ok){console.error("showStoryDetailAndMap: response:",t),e(this,i).populateStoryDetailError(t.message);return}const o=await S(t.story);e(this,i).populateStoryDetailAndInitialMap(t.message,o)}catch(t){console.error("showStoryDetailAndMap: error:",t),e(this,i).populateStoryDetailError(t.message)}finally{e(this,i).hideStoryDetailLoading()}}async showToggleSaveButton(){if(await this.checkIsFavorited()){e(this,i).renderRemoveButton();return}e(this,i).renderSaveButton()}async handleSaveStory(){try{const t=await e(this,l).saveStory(e(this,d));if(t.ok)e(this,i).showNotification("Story berhasil disimpan!","success"),await this.showToggleSaveButton();else throw new Error(t.message||"Gagal menyimpan story")}catch(t){console.error("Error saving story:",t),e(this,i).showNotification("Gagal menyimpan story: "+t.message,"error")}}async handleRemoveStory(){try{const t=await e(this,l).removeStory(e(this,d));if(t.ok)e(this,i).showNotification("Story berhasil dihapus dari bookmark!","success"),await this.showToggleSaveButton();else throw new Error(t.message||"Gagal menghapus story")}catch(t){console.error("Error removing story:",t),e(this,i).showNotification("Gagal menghapus story: "+t.message,"error")}}async checkIsFavorited(){return await M.isFavorite(e(this,d))}}d=new WeakMap,i=new WeakMap,l=new WeakMap;var s,c;class C{constructor(){y(this,s,null);y(this,c,null)}async render(){return`
      <section>
        <div class="story-detail__container">
          <div id="story-detail" class="story-detail"></div>
          <div id="story-detail-loading-container"></div>
        </div>
      </section>
    `}async afterRender(){m(this,s,new k(B().id,{view:this,apiModel:E})),e(this,s).showStoryDetail()}async populateStoryDetailAndInitialMap(t,o){const n=await S(o);if(document.getElementById("story-detail")&&(document.getElementById("story-detail").innerHTML=I({...n})),L(document.getElementById("images")),await e(this,s).showStoryDetailMap(),e(this,c)&&n.lat&&n.lon){const h=[n.lat,n.lon],w={alt:n.description},f={content:n.description};e(this,c).changeCamera(h),e(this,c).addMarker(h,w,f)}await e(this,s).checkIsFavorited()?this.renderRemoveButton():this.renderSaveButton()}populateStoryDetailError(t){document.getElementById("story-detail").innerHTML=T(t)}async initialMap(){document.getElementById("map")&&m(this,c,await D.build("#map",{zoom:15}))}renderSaveButton(){document.getElementById("save-actions-container").innerHTML=p(!1),document.getElementById("story-detail-favorite").addEventListener("click",async()=>{await e(this,s).handleSaveStory()})}renderRemoveButton(){document.getElementById("save-actions-container").innerHTML=p(!0),document.getElementById("story-detail-favorite").addEventListener("click",async()=>{await e(this,s).handleRemoveStory()})}showStoryDetailLoading(){document.getElementById("story-detail-loading-container").innerHTML=v()}hideStoryDetailLoading(){document.getElementById("story-detail-loading-container").innerHTML=""}showMapLoading(){document.getElementById("map-loading-container")&&(document.getElementById("map-loading-container").innerHTML=v())}hideMapLoading(){document.getElementById("map-loading-container")&&(document.getElementById("map-loading-container").innerHTML="")}showSubmitLoadingButton(){document.getElementById("submit-button-container").innerHTML=`
      <button class="btn" type="submit" disabled>
        <i class="fas fa-spinner loader-button"></i> Tanggapi
      </button>
    `}hideSubmitLoadingButton(){document.getElementById("submit-button-container").innerHTML=`
      <button class="btn" type="submit">Tanggapi</button>
    `}showAlert(t){this.showNotification(t)}showNotification(t,o="success"){const n=document.querySelector(".notification");n&&n.remove();let r=document.getElementById("notification-container");r||(r=document.createElement("div"),r.id="notification-container",document.body.appendChild(r)),r.innerHTML=b(t,o);const h=r.querySelector(".notification__close");h&&h.addEventListener("click",()=>{r.innerHTML=""}),setTimeout(()=>{r&&(r.innerHTML="")},3e3)}}s=new WeakMap,c=new WeakMap;export{C as default};
