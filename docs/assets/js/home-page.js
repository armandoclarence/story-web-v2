var w=o=>{throw TypeError(o)};var v=(o,t,e)=>t.has(o)||w("Cannot "+e);var s=(o,t,e)=>(v(o,t,"read from private field"),e?e.call(o):t.get(o)),g=(o,t,e)=>t.has(o)?w("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(o):t.set(o,e),p=(o,t,e,i)=>(v(o,t,"write to private field"),i?i.call(o,e):t.set(o,e),e),L=(o,t,e)=>(v(o,t,"access private method"),e);var E=(o,t,e,i)=>({set _(a){p(o,t,a,e)},get _(){return s(o,t,i)}});import{F as y,S,g as M,a as b,b as H}from"./main.js";import{s as P}from"./api-mapper.js";import{g as _,a as k}from"./ui-templates.js";import"./map.js";var l,h;class z{constructor({view:t,model:e}){g(this,l);g(this,h);p(this,l,t),p(this,h,e)}async loadStories({page:t,size:e}){try{s(this,l).showLoading();const i=await s(this,h).getStories({page:t,size:e});if(!i.ok)throw new Error(i.error||"Failed to load stories");await s(this,l).populateStoriesList("",i.listStory,i.isFromCache)}catch(i){s(this,l).populateStoriesListError(i.message)}finally{s(this,l).hideLoading()}}async toggleFavorite(t){try{if(await y.isFavorite(t))await y.removeFavorite(t);else{const i=await s(this,h).getStoryById(t);i.ok&&await y.addFavorite(i.story)}}catch(e){throw console.error("Error toggling favorite:",e),e}}}l=new WeakMap,h=new WeakMap;var n,f,c,u,I,B;class j{constructor(){g(this,u);g(this,n,1);g(this,f,10);g(this,c)}async render(){return`
      <section class="container">
        <h1 class="section-title">Daftar Story</h1>

        <div class="stories-list__container">
          <div id="offline-indicator"></div>
          <div id="stories-list"></div>
          <div id="stories-list-loading-container"></div>
          <div id="pagination-container"></div>
        </div>
      </section>
    `}async afterRender(){p(this,c,new z({view:this,model:S})),await y.init(S),await s(this,c).loadStories({page:s(this,n),size:s(this,f)}),L(this,u,B).call(this),L(this,u,I).call(this)}async populateStoriesList(t,e,i=!1){if((e==null?void 0:e.length)<=0){this.populateStoriesListEmpty();return}const a=await Promise.all(e.map(async r=>{const F=await P(r),T=await y.isFavorite(r.id);return M({...F,isFavorited:T,isOffline:i})})).then(r=>r.join("")),d=document.getElementById("stories-list");if(!d){console.error("Element 'stories-list' not found!");return}d.innerHTML=`
      <div class="stories-list">${a}</div>
    `;const m=document.getElementById("pagination-container");if(m){const r=e.length<s(this,f);m.innerHTML=_(s(this,n),r)}i?this.showOfflineIndicator():this.hideOfflineIndicator()}populateStoriesListEmpty(){const t=document.getElementById("stories-list");if(!t){console.error("Element 'stories-list' not found!");return}t.innerHTML=b()}populateStoriesListError(t){const e=document.getElementById("stories-list");if(!e){console.error("Element 'stories-list' not found!");return}e.innerHTML=H(t)}showLoading(){const t=document.getElementById("stories-list-loading-container");if(!t){console.error("Element 'stories-list-loading-container' not found!");return}t.innerHTML=k()}hideLoading(){const t=document.getElementById("stories-list-loading-container");if(!t){console.error("Element 'stories-list-loading-container' not found!");return}t.innerHTML=""}showOfflineIndicator(){const t=document.getElementById("offline-indicator");if(!t)return;t.innerHTML=`
      <div class="offline-indicator">
        <i class="fas fa-wifi wifi-slash"></i>
        <span>Anda sedang offline. Menampilkan cerita yang tersimpan.</span>
        <button class="offline-indicator__retry">Coba Lagi</button>
      </div>
    `;const e=t.querySelector(".offline-indicator__retry");e&&e.addEventListener("click",()=>{window.location.reload()})}hideOfflineIndicator(){const t=document.getElementById("offline-indicator");t&&(t.innerHTML="")}}n=new WeakMap,f=new WeakMap,c=new WeakMap,u=new WeakSet,I=function(){const t=document.getElementById("stories-list");t&&t.addEventListener("click",async e=>{const i=e.target.closest(".story-item__favorite");if(!i)return;const a=i.dataset.storyId;if(a)try{i.classList.contains("active")&&await s(this,c).toggleFavorite(a)}catch(d){console.error("Error toggling favorite:",d),alert("Gagal menghapus cerita dari favorit.")}})},B=function(){const t=document.getElementById("pagination-container");if(!t)return;let e=!1;t.addEventListener("click",async i=>{if(e)return;const a=i.target.closest("#prev-page"),d=i.target.closest("#next-page");if(a||d)try{e=!0,t.querySelectorAll("button").forEach(r=>{r.disabled=!0,r.classList.add("loading")}),a&&s(this,n)>1?(E(this,n)._--,await s(this,c).loadStories({page:s(this,n),size:s(this,f)})):d&&(E(this,n)._++,await s(this,c).loadStories({page:s(this,n),size:s(this,f)}))}catch(m){console.error("Error loading stories:",m)}finally{e=!1,t.querySelectorAll("button").forEach(r=>{r.disabled=!1,r.classList.remove("loading")})}})};export{j as default};
