var E=i=>{throw TypeError(i)};var L=(i,t,e)=>t.has(i)||E("Cannot "+e);var o=(i,t,e)=>(L(i,t,"read from private field"),e?e.call(i):t.get(i)),c=(i,t,e)=>t.has(i)?E("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(i):t.set(i,e),u=(i,t,e,s)=>(L(i,t,"write to private field"),s?s.call(i,e):t.set(i,e),e),v=(i,t,e)=>(L(i,t,"access private method"),e);var y=(i,t,e,s)=>({set _(l){u(i,t,l,e)},get _(){return o(i,t,s)}});import{S,F as T,g as B,a as M,b,c as H,d as P}from"./index.js";import{s as C}from"./api-mapper.js";import"./map.js";var d,h;class F{constructor({view:t,model:e}){c(this,d);c(this,h);u(this,d,t),u(this,h,e)}async loadStories({page:t,size:e}){var s,l;try{o(this,d).showLoading();const n=await o(this,h).getStories({page:t,size:e});if(console.log(n),(s=n==null?void 0:n.data)!=null&&s.error||!(n!=null&&n.ok))throw new Error(((l=n==null?void 0:n.data)==null?void 0:l.error)||"Failed to load stories");await o(this,d).populateStoriesList("",n.data.listStory,n.isFromCache)}catch(n){o(this,d).populateStoriesListError(n.message)}finally{o(this,d).hideLoading()}}}d=new WeakMap,h=new WeakMap;var a,f,g,p,w;class q{constructor(){c(this,p);c(this,a,1);c(this,f,10);c(this,g)}async render(){return`
      <section class="container">
        <h1 class="section-title">Daftar Story</h1>

        <div class="stories-list__container">
          <div id="offline-indicator"></div>
          <div id="stories-list"></div>
          <div id="stories-list-loading-container"></div>
          <div id="pagination-container"></div>
        </div>
      </section>
    `}async afterRender(){u(this,g,new F({view:this,model:S})),await T.init(S),await o(this,g).loadStories({page:o(this,a),size:o(this,f)}),v(this,p,w).call(this)}async populateStoriesList(t,e,s=!1){if((e==null?void 0:e.length)<=0){this.populateStoriesListEmpty();return}const l=await Promise.all(e.map(async r=>{const I=await C(r);return console.log(r),B({...I,isFavorited:r.isFavorite,isOffline:s})})).then(r=>r.join("")),n=document.getElementById("stories-list");if(!n){console.error("Element 'stories-list' not found!");return}n.innerHTML=`
      <div class="stories-list">${l}</div>
    `;const m=document.getElementById("pagination-container");if(m){const r=e.length<o(this,f);m.innerHTML=M(o(this,a),r)}s?this.showOfflineIndicator():this.hideOfflineIndicator()}populateStoriesListEmpty(){const t=document.getElementById("stories-list");if(!t){console.error("Element 'stories-list' not found!");return}t.innerHTML=b()}populateStoriesListError(t){const e=document.getElementById("stories-list");if(!e){console.error("Element 'stories-list' not found!");return}e.innerHTML=H(t)}showLoading(){const t=document.getElementById("stories-list-loading-container");if(!t){console.error("Element 'stories-list-loading-container' not found!");return}t.innerHTML=P()}hideLoading(){const t=document.getElementById("stories-list-loading-container");if(!t){console.error("Element 'stories-list-loading-container' not found!");return}t.innerHTML=""}showOfflineIndicator(){const t=document.getElementById("offline-indicator");if(!t)return;t.innerHTML=`
      <div class="offline-indicator">
        <i class="fas fa-wifi wifi-slash"></i>
        <span>Anda sedang offline. Menampilkan cerita yang tersimpan.</span>
        <button class="offline-indicator__retry">Coba Lagi</button>
      </div>
    `;const e=t.querySelector(".offline-indicator__retry");e&&e.addEventListener("click",()=>{window.location.reload()})}hideOfflineIndicator(){const t=document.getElementById("offline-indicator");t&&(t.innerHTML="")}}a=new WeakMap,f=new WeakMap,g=new WeakMap,p=new WeakSet,w=function(){const t=document.getElementById("pagination-container");if(!t)return;let e=!1;t.addEventListener("click",async s=>{if(e)return;const l=s.target.closest("#prev-page"),n=s.target.closest("#next-page");if(l||n)try{e=!0,t.querySelectorAll("button").forEach(r=>{r.disabled=!0,r.classList.add("loading")}),l&&o(this,a)>1?(y(this,a)._--,await o(this,g).loadStories({page:o(this,a),size:o(this,f)})):n&&(y(this,a)._++,await o(this,g).loadStories({page:o(this,a),size:o(this,f)}))}catch(m){console.error("Error loading stories:",m)}finally{e=!1,t.querySelectorAll("button").forEach(r=>{r.disabled=!1,r.classList.remove("loading")})}})};export{q as default};
