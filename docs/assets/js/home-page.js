var E=i=>{throw TypeError(i)};var L=(i,t,e)=>t.has(i)||E("Cannot "+e);var o=(i,t,e)=>(L(i,t,"read from private field"),e?e.call(i):t.get(i)),c=(i,t,e)=>t.has(i)?E("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(i):t.set(i,e),m=(i,t,e,s)=>(L(i,t,"write to private field"),s?s.call(i,e):t.set(i,e),e),v=(i,t,e)=>(L(i,t,"access private method"),e);var y=(i,t,e,s)=>({set _(l){m(i,t,l,e)},get _(){return o(i,t,s)}});import{S as w,r as B,I as M,F as T,g as b,a as H,b as P,c as C,d as F}from"./index.js";import{s as _}from"./api-mapper.js";import"./map.js";var d,h;class z{constructor({view:t,model:e}){c(this,d);c(this,h);m(this,d,t),m(this,h,e)}async loadStories({page:t,size:e}){var s,l;try{o(this,d).showLoading();const n=await o(this,h).getStories({page:t,size:e});if(console.log(n),(s=n==null?void 0:n.data)!=null&&s.error||!(n!=null&&n.ok))throw new Error(((l=n==null?void 0:n.data)==null?void 0:l.error)||"Failed to load stories");await o(this,d).populateStoriesList("",n.data.listStory,n.isFromCache)}catch(n){o(this,d).populateStoriesListError(n.message)}finally{o(this,d).hideLoading()}}}d=new WeakMap,h=new WeakMap;var r,g,f,p,S;class O{constructor(){c(this,p);c(this,r,1);c(this,g,10);c(this,f)}async render(){return`
      <section class="container">
        <h1 class="section-title">Daftar Story</h1>

        <div class="stories-list__container">
          <div id="offline-indicator"></div>
          <div id="stories-list"></div>
          <div id="stories-list-loading-container"></div>
          <div id="pagination-container"></div>
        </div>
      </section>
    `}async afterRender(){m(this,f,new z({view:this,model:w})),await B(await M.init()),await T.init(w),await o(this,f).loadStories({page:o(this,r),size:o(this,g)}),v(this,p,S).call(this)}async populateStoriesList(t,e,s=!1){if((e==null?void 0:e.length)<=0){this.populateStoriesListEmpty();return}const l=await Promise.all(e.map(async a=>{const I=await _(a);return console.log(a),b({...I,isFavorited:a.isFavorite,isOffline:s})})).then(a=>a.join("")),n=document.getElementById("stories-list");if(!n){console.error("Element 'stories-list' not found!");return}n.innerHTML=`
      <div class="stories-list">${l}</div>
    `;const u=document.getElementById("pagination-container");if(u){const a=e.length<o(this,g);u.innerHTML=H(o(this,r),a)}s?this.showOfflineIndicator():this.hideOfflineIndicator()}populateStoriesListEmpty(){const t=document.getElementById("stories-list");if(!t){console.error("Element 'stories-list' not found!");return}t.innerHTML=P()}populateStoriesListError(t){const e=document.getElementById("stories-list");if(!e){console.error("Element 'stories-list' not found!");return}e.innerHTML=C(t)}showLoading(){const t=document.getElementById("stories-list-loading-container");if(!t){console.error("Element 'stories-list-loading-container' not found!");return}t.innerHTML=F()}hideLoading(){const t=document.getElementById("stories-list-loading-container");if(!t){console.error("Element 'stories-list-loading-container' not found!");return}t.innerHTML=""}showOfflineIndicator(){const t=document.getElementById("offline-indicator");if(!t)return;t.innerHTML=`
      <div class="offline-indicator">
        <i class="fas fa-wifi wifi-slash"></i>
        <span>Anda sedang offline. Menampilkan cerita yang tersimpan.</span>
        <button class="offline-indicator__retry">Coba Lagi</button>
      </div>
    `;const e=t.querySelector(".offline-indicator__retry");e&&e.addEventListener("click",()=>{window.location.reload()})}hideOfflineIndicator(){const t=document.getElementById("offline-indicator");t&&(t.innerHTML="")}}r=new WeakMap,g=new WeakMap,f=new WeakMap,p=new WeakSet,S=function(){const t=document.getElementById("pagination-container");if(!t)return;let e=!1;t.addEventListener("click",async s=>{if(e)return;const l=s.target.closest("#prev-page"),n=s.target.closest("#next-page");if(l||n)try{e=!0,t.querySelectorAll("button").forEach(a=>{a.disabled=!0,a.classList.add("loading")}),l&&o(this,r)>1?(y(this,r)._--,await o(this,f).loadStories({page:o(this,r),size:o(this,g)})):n&&(y(this,r)._++,await o(this,f).loadStories({page:o(this,r),size:o(this,g)}))}catch(u){console.error("Error loading stories:",u)}finally{e=!1,t.querySelectorAll("button").forEach(a=>{a.disabled=!1,a.classList.remove("loading")})}})};export{O as default};
