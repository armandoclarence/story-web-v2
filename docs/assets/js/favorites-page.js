var L=r=>{throw TypeError(r)};var h=(r,t,e)=>t.has(r)||L("Cannot "+e);var d=(r,t,e)=>(h(r,t,"read from private field"),e?e.call(r):t.get(r)),f=(r,t,e)=>t.has(r)?L("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(r):t.set(r,e),F=(r,t,e,a)=>(h(r,t,"write to private field"),a?a.call(r,e):t.set(r,e),e),w=(r,t,e)=>(h(r,t,"access private method"),e);import{s as M}from"./api-mapper.js";import{F as p,S as T,g as E}from"./main.js";import"./map.js";class B{constructor({view:t,model:e}){this.view=t,this.model=e}async loadFavorites(){try{const t=await p.getAllFavorites(),e=t.length>10;await this.view.showFavorites(t,e)}catch(t){throw console.error("Error loading favorites:",t),t}}async toggleFavorite(t){try{return await p.isFavorite(t)?(await p.removeFavorite(t),await(await caches.open("api-cache-v1")).delete(`/stories/${t}`),!0):!1}catch(e){throw console.error("Error toggling favorite:",e),e}}}var y,l,m,I,S;class C{constructor(){f(this,m);f(this,y,10);f(this,l)}async render(){return`
      <section class="container">
        <h1 class="section-title">Cerita Favorit</h1>
        <div id="favorites-list" class="stories-list"></div>
        <div id="pagination-container"></div>
      </section>
    `}async afterRender(){F(this,l,new B({view:this,model:T})),await p.init(T),document.addEventListener("favorites-updated",async()=>{await d(this,l).loadFavorites()}),await d(this,l).loadFavorites(),w(this,m,S).call(this)}async showFavorites(t,e){const a=document.getElementById("favorites-list"),i=document.getElementById("pagination-container");if(!t||t.length===0){a&&(a.innerHTML="<p>Belum ada cerita favorit.</p>"),i&&(i.innerHTML="");return}try{const s=t.slice(0,d(this,y)),n=await Promise.all(s.map(async v=>{const o=await M(v);return E({...o,isFavorited:!0})}));a&&(a.innerHTML=n.join(""),setTimeout(()=>{a.querySelectorAll(".story-item").forEach((o,u)=>{o.style.opacity="0",o.style.transform="translateY(20px)",setTimeout(()=>{o.style.opacity="1",o.style.transform="translateY(0)"},u*100)})},50)),i&&(e?(i.innerHTML=`
            <div class="pagination">
              <button class="load-more-button">
                <span>Muat Lebih Banyak</span>
                <i class="fas fa-chevron-down"></i>
              </button>
            </div>
          `,w(this,m,I).call(this,t)):i.innerHTML="")}catch(s){console.error("Error showing favorites:",s),a&&(a.innerHTML="<p>Terjadi kesalahan saat memuat cerita favorit.</p>"),i&&(i.innerHTML="")}}}y=new WeakMap,l=new WeakMap,m=new WeakSet,I=function(t){const e=document.querySelector(".load-more-button");if(!e)return;let a=!1;e.addEventListener("click",async()=>{if(!a)try{a=!0,e.classList.add("loading"),e.disabled=!0;const i=e.querySelector("span");i.textContent="Memuat...";const s=document.querySelectorAll(".story-item").length,n=t.slice(s,s+d(this,y));if(n.length>0){await new Promise(c=>setTimeout(c,500));const v=await Promise.all(n.map(async c=>{const g=await M(c);return E({...g,isFavorited:!0})})),o=document.getElementById("favorites-list"),u=document.createElement("div");u.innerHTML=v.join(""),Array.from(u.children).forEach((c,g)=>{c.style.opacity="0",c.style.transform="translateY(20px)",o.appendChild(c),setTimeout(()=>{c.style.opacity="1",c.style.transform="translateY(0)"},g*100)}),s+n.length>=t.length&&(e.style.display="none")}}catch(i){console.error("Error loading more items:",i)}finally{a=!1,e.classList.remove("loading"),e.disabled=!1;const i=e.querySelector("span");i.textContent="Muat Lebih Banyak"}})},S=function(){const t=document.getElementById("favorites-list");t&&t.addEventListener("click",async e=>{const a=e.target.closest(".story-item__favorite");if(!a)return;const i=a.dataset.storyId;if(i)try{if(a.classList.contains("active")&&await d(this,l).toggleFavorite(i)){const n=a.closest(".story-item");if(n){if(n.classList.add("removing"),await new Promise(o=>{n.addEventListener("transitionend",()=>{n.remove(),o()},{once:!0})}),t.querySelectorAll(".story-item").length===0){t.innerHTML="<p>Belum ada cerita favorit.</p>";const o=document.getElementById("pagination-container");o&&(o.innerHTML="")}await d(this,l).loadFavorites()}}}catch(s){console.error("Error toggling favorite:",s),alert("Gagal menghapus cerita dari favorit.")}})};export{C as default};
