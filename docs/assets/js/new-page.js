var E=o=>{throw TypeError(o)};var f=(o,t,e)=>t.has(o)||E("Cannot "+e);var n=(o,t,e)=>(f(o,t,"read from private field"),e?e.call(o):t.get(o)),u=(o,t,e)=>t.has(o)?E("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(o):t.set(o,e),h=(o,t,e,a)=>(f(o,t,"write to private field"),a?a.call(o,e):t.set(o,e),e),r=(o,t,e)=>(f(o,t,"access private method"),e);import k from"./new-presenter.js";import{S as T,C as S,e as M,d as P}from"./index.js";import{g as C,a as x}from"./form-templates.js";import{M as b}from"./map.js";var g,s,d,y,l,c,i,w,L,B,I,p,v;class D{constructor(){u(this,i);u(this,g);u(this,s);u(this,d);u(this,y,!1);u(this,l,[]);u(this,c,null)}async render(){return C(!1,await b.isPermissionsGeolocationGranted())}async afterRender(){h(this,g,new k({view:this,model:T})),h(this,l,[]),document.querySelector("#map-req")&&document.querySelector("#map-req").addEventListener("click",async()=>{await b.tryGetLocation()}),n(this,g).showNewFormMap(),r(this,i,w).call(this)}async initialMap(){if(!document.querySelector("#map")||(h(this,c,await b.build("#map",{zoom:15})),!n(this,c)))return;const t=n(this,c).getCenter();console.log(n(this,c)),n(this,c).changeCamera([t.latitude,t.longitude]),r(this,i,L).call(this,t.latitude,t.longitude);const e=n(this,c).addMarker([t.latitude,t.longitude],{draggable:"true"});e.addEventListener("move",a=>{const m=a.target.getLatLng();r(this,i,L).call(this,m.lat,m.lng)}),n(this,c).addMapEventListener("click",a=>{e.setLatLng(a.latlng),a.sourceTarget.flyTo(a.latlng)})}storeSuccessfully(t){alert(t),console.log(t),this.clearForm(),location.hash="/"}storeFailed(t){alert(t),console.log(t)}clearForm(){n(this,s).reset()}showMapLoading(){document.getElementById("map-loading-container")&&(document.getElementById("map-loading-container").innerHTML=P())}hideMapLoading(){document.getElementById("map-loading-container")&&(document.getElementById("map-loading-container").innerHTML="")}showSubmitLoadingButton(){document.getElementById("submit-button-container")&&(document.getElementById("submit-button-container").innerHTML=`
        <button class="btn" type="submit" disabled>
          <i class="fas fa-spinner loader-button"></i> Buat Cerita
        </button>
      `)}hideSubmitLoadingButton(){document.getElementById("submit-button-container")&&(document.getElementById("submit-button-container").innerHTML=`
        <button class="btn" type="submit">Buat Cerita</button>
      `)}}g=new WeakMap,s=new WeakMap,d=new WeakMap,y=new WeakMap,l=new WeakMap,c=new WeakMap,i=new WeakSet,w=function(){h(this,s,document.getElementById("new-form")),n(this,s).addEventListener("submit",async e=>{if(e.preventDefault(),n(this,s).elements.namedItem("description").value===""){alert("Keterangan tidak boleh kosong");return}if(n(this,l).length===0){alert("Dokumentasi tidak boleh kosong");return}let a={description:n(this,s).elements.namedItem("description").value,photo:n(this,l)[0].blob};await b.isPermissionsGeolocationGranted()&&(a={...a,lat:n(this,s).elements.namedItem("latitude").value,lon:n(this,s).elements.namedItem("longitude").value}),await n(this,g).postNewStory(a)}),document.getElementById("photo-input").addEventListener("change",async e=>{const a=Object.values(e.target.files).map(async m=>await r(this,i,I).call(this,m));await Promise.all(a),await r(this,i,p).call(this)}),document.getElementById("photo-input-button").addEventListener("click",()=>{n(this,s).elements.namedItem("photo-input").click()});const t=document.getElementById("camera-container");document.getElementById("open-photo-camera-button").addEventListener("click",async e=>{r(this,i,B).call(this),h(this,y,t.classList.contains("open")),n(this,y)?(t.classList.remove("open"),e.currentTarget.textContent="Buka Kamera",n(this,d).stop()):(t.classList.add("open"),e.currentTarget.textContent="Tutup Kamera",await n(this,d).launch())})},L=function(t,e){n(this,s).elements.namedItem("latitude").value=t,n(this,s).elements.namedItem("longitude").value=e},B=function(){n(this,d)||h(this,d,new S({video:document.getElementById("camera-video"),cameraSelect:document.getElementById("camera-select"),canvas:document.getElementById("camera-canvas")})),n(this,d).addCheeseButtonListener("#camera-take-button",async()=>{const t=await n(this,d).takePicture();await r(this,i,I).call(this,t),await r(this,i,p).call(this)})},I=async function(t){let e=t;t instanceof String&&(e=M(t,"image/png"));const a={id:`${Date.now()}-${Math.random().toString(36).substring(2,9)}`,blob:e};h(this,l,[...n(this,l),a])},p=async function(){const t=n(this,l).reduce((e,a)=>{const m=URL.createObjectURL(a.blob);return e+x(m,a.id)},"");document.getElementById("photo-taken-list").innerHTML=t,document.querySelectorAll("button[data-index]").forEach(e=>e.addEventListener("click",a=>{const m=a.currentTarget.dataset.index;r(this,i,v).call(this,m),r(this,i,p).call(this)}))},v=function(t){const e=n(this,l).findIndex(a=>(a.id||"").toString()===t.toString());if(e!==-1){const a=document.querySelector(`[data-photo-id="${t}"]`);a&&(a.style.transition="all 0.3s ease",a.style.opacity="0",a.style.transform="scale(0.  8)",setTimeout(()=>{n(this,l).splice(e,1),document.getElementById("photo-input").value="",r(this,i,p).call(this)},300))}};export{D as default};
